<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>SAM Doc : Update-20</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            SAM Doc : Update-20
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Apr 26, 2013 by <font color="#0050B2">roveznav</font>.
				    </div>

				    <div>
<ul>
    <li><a href='#Update-20-Summary'>Summary</a></li>
    <li><a href='#Update-20-Description'>Description</a></li>
    <li><a href='#Update-20-PackageList'>Package List</a></li>
<ul>
    <li><a href='#Update-20-SAMNagios'>SAM-Nagios</a></li>
    <li><a href='#Update-20-SAMGridmon'>SAM-Gridmon</a></li>
</ul>
    <li><a href='#Update-20-ConfigurationChanges'>Configuration Changes</a></li>
<ul>
    <li><a href='#Update-20-Common'>Common</a></li>
    <li><a href='#Update-20-SAMGridmon'>SAM-Gridmon</a></li>
    <li><a href='#Update-20-SAMNagios'>SAM-Nagios</a></li>
    <li><a href='#Update-20-Localdbchanges'>Localdb changes</a></li>
</ul>
    <li><a href='#Update-20-KnownIssues'>Known Issues</a></li>
    <li><a href='#Update-20-TicketsList'>Tickets List</a></li>
</ul></div>

<h2><a name="Update-20-Summary"></a>Summary</h2>

<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<td class='confluenceTd'> Start Date </td>
<td class='confluenceTd'> 29 October 2012 </td>
</tr>
<tr>
<td class='confluenceTd'> Release Date </td>
<td class='confluenceTd'> 07 December 2012 </td>
</tr>
<tr>
<td class='confluenceTd'> Status </td>
<td class='confluenceTd'> Released </td>
</tr>
<tr>
<td class='confluenceTd'> Validation Steps </td>
<td class='confluenceTd'> <a href="https://tomtools.cern.ch/jira/browse/SAM-3071">SAM-3071</a> </td>
</tr>
<tr>
<td class='confluenceTd'> Validated </td>
<td class='confluenceTd'> 06 March 2013 </td>
</tr>
</tbody></table>
</div>


<h2><a name="Update-20-Description"></a>Description</h2>

<p>This release was mainly focused on the introduction of SAM Operational Tools Monitoring. In addition we worked on bug fixing identified during the wide deployment of SAM Update 19.</p>

<p>Technical details:</p>
<ul>
	<li>70 tickets resolved</li>
	<li>Topology aggregation:
	<ul>
		<li>Added sanity check to compare differences between services declared in local ATP with central ATP</li>
		<li>Enabled VOMS CSRF support</li>
		<li>Fixed problem of invalid json output provided by ATP PI, which was affecting NCG</li>
	</ul>
	</li>
	<li>Profile Management:
	<ul>
		<li>Unit test moved to Django 1.3</li>
	</ul>
	</li>
	<li>MyWLCG changes:
	<ul>
		<li>MyWLCG Error Handling improved</li>
		<li>Status view improved</li>
		<li>Added monthly reports to the central MyEGI</li>
		<li>Two new reports for T0/T1 sites</li>
	</ul>
	</li>
	<li>Nagios configuration:
	<ul>
		<li>Enabled defining contacts for services</li>
		<li>ncg.localdb partially migrated to ncg-metric-config (json format)</li>
		<li>Optimized Java truststore generation</li>
		<li>Added option to give permissions to run Nagios commands to anybody with a valid D</li>
	</ul>
	</li>
	<li>Probes:
	<ul>
		<li>grid-monitoring-probes-ch.cern.sam:
		<ul>
			<li>MrsCheckDBInsertsDetailed probe improved</li>
			<li>SamCheckUpdate probe improved</li>
			<li>Added SAMCentralWebAPI probe</li>
		</ul>
		</li>
		<li>hr.srce.GridProxy-Get generates proxies with configurable lifetime</li>
		<li>Probe libraries ported to SL6 (perl-TOM, python-GridMon and perl-GridMon)</li>
		<li>Fixed mta-simple problem in grid-monitoring-probes-org.sam</li>
	</ul>
	</li>
	<li>MRS metrics disabled on SAM/Nagios nodes</li>
	<li>SAM configuration changes (glite-yaim-nagios):
	<ul>
		<li>Consolidated/minimized number of httpd actions</li>
		<li>Consolidation of YAIM variables (names uppercase)</li>
		<li>OPS-MONITOR established as new SAM/Nagios configuration (for monitoring operational tools)</li>
		<li>EGI report: switched Availability and Reliability labels</li>
		<li>Decommission of MDDB</li>
		<li>Improved MySQL database dump</li>
		<li>Source code documentation</li>
		<li>Removed dependencies on DAG repository</li>
	</ul>
	</li>
</ul>


<h2><a name="Update-20-PackageList"></a>Package List</h2>

<h3><a name="Update-20-SAMNagios"></a>SAM-Nagios</h3>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre> atp-1.26.4-1.el5
 glite-yaim-nagios-1.9.18-1.el5
 grid-monitoring-config-gen-0.91.3-1.el5
 grid-monitoring-probes-hr.srce-0.36.1-1.el5
 grid-monitoring-probes-org.sam-0.5.8-1.el5
 grid-monitoring-probes-ch.cern.sam-1.6.13-1.el5
 mrs-1.7.35-1.el5
 mywlcg-1.5.1-5.el5
 mywlcg-atp-api-1.26.1-1.el5
 mywlcg-atp-web-1.26.2-1.el5
 ncg-metric-config-1.2.3-1.el5
 perl-GridMon-1.0.62-1.el5
 python-GridMon-1.1.12-1.el5
</pre>
</div></div>

<h3><a name="Update-20-SAMGridmon"></a>SAM-Gridmon</h3>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>ace-0.2.5-1.el5
 atp-1.26.4-1.el5
 mrs-1.7.35-1.el5
 mywlcg-1.5.1-5.el5
 mywlcg-atp-api-1.26.1-1.el5
 mywlcg-atp-web-1.26.2-1.el5
 glite-yaim-nagios-1.9.18-1.el5
</pre>
</div></div>


<h2><a name="Update-20-ConfigurationChanges"></a>Configuration Changes</h2>

<h3><a name="Update-20-Common"></a>Common</h3>

<ul>
	<li>New Yaim configuration variables:
<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Component </th>
<th class='confluenceTh'> Name </th>
<th class='confluenceTh'> Description </th>
<th class='confluenceTh'> Default </th>
<th class='confluenceTh'> Mandatory </th>
<th class='confluenceTh'> Example </th>
</tr>
<tr>
<td class='confluenceTd'> ATP </td>
<td class='confluenceTd'> MSG_DEST_OSG_DOWNTIME </td>
<td class='confluenceTd'> Messaging queue for OSG downtimes </td>
<td class='confluenceTd'> Yes </td>
<td class='confluenceTd'> Yes </td>
<td class='confluenceTd'> /topic/grid.management.downtime.RSV </td>
</tr>
</tbody></table>
</div>
</li>
</ul>


<h3><a name="Update-20-SAMGridmon"></a>SAM-Gridmon</h3>

<ul>
	<li>New Yaim configuration variables
<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Component </th>
<th class='confluenceTh'> Name </th>
<th class='confluenceTh'> Description </th>
<th class='confluenceTh'> Default </th>
<th class='confluenceTh'> Mandatory </th>
<th class='confluenceTh'> Example </th>
</tr>
<tr>
<td class='confluenceTd'> MyWLCG </td>
<td class='confluenceTd'> MYWLCG_TRENDS </td>
<td class='confluenceTd'> Enable/disable Trends on MyWLCG </td>
<td class='confluenceTd'> No </td>
<td class='confluenceTd'> No </td>
<td class='confluenceTd'> false </td>
</tr>
</tbody></table>
</div>
</li>
</ul>


<h3><a name="Update-20-SAMNagios"></a>SAM-Nagios</h3>

<ul>
	<li>New Yaim configuration variables:
<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Component </th>
<th class='confluenceTh'> Name </th>
<th class='confluenceTh'> Description </th>
<th class='confluenceTh'> Default </th>
<th class='confluenceTh'> Mandatory </th>
<th class='confluenceTh'> Example </th>
</tr>
<tr>
<td class='confluenceTd'> nagios </td>
<td class='confluenceTd'> NAGIOS_ENABLE_ANY_DN </td>
<td class='confluenceTd'> Enable/disable of any DN to run Nagios commands on VO-nagioses </td>
<td class='confluenceTd'> Yes </td>
<td class='confluenceTd'> No </td>
<td class='confluenceTd'> false </td>
</tr>
<tr>
<td class='confluenceTd'> NCG </td>
<td class='confluenceTd'> CRO_BROKER_PASS </td>
<td class='confluenceTd'> BROKER_PASSWORD value for msg.cro-ngi.hr broker </td>
<td class='confluenceTd'> No </td>
<td class='confluenceTd'> No </td>
<td class='confluenceTd'> MyPass </td>
</tr>
<tr>
<td class='confluenceTd'> NCG </td>
<td class='confluenceTd'> EGI1_BROKER_PASS </td>
<td class='confluenceTd'> BROKER_PASSWORD value for egi-1.msg.cern.ch broker </td>
<td class='confluenceTd'> No </td>
<td class='confluenceTd'> No </td>
<td class='confluenceTd'> MyPass </td>
</tr>
<tr>
<td class='confluenceTd'> NCG </td>
<td class='confluenceTd'> EGI2_BROKER_PASS </td>
<td class='confluenceTd'> BROKER_PASSWORD value for egi-2.msg.cern.ch broker </td>
<td class='confluenceTd'> No </td>
<td class='confluenceTd'> No </td>
<td class='confluenceTd'> MyPass </td>
</tr>
<tr>
<td class='confluenceTd'> NCG </td>
<td class='confluenceTd'> GR_BROKER_PASS </td>
<td class='confluenceTd'> BROKER_PASSWORD value for broker.afroditi.hellasgrid.gr broker </td>
<td class='confluenceTd'> No </td>
<td class='confluenceTd'> No </td>
<td class='confluenceTd'> MyPass </td>
</tr>
<tr>
<td class='confluenceTd'> NCG </td>
<td class='confluenceTd'> NCG_SERVICE_NOTIFICATIONS_OPTIONS </td>
<td class='confluenceTd'> Nagios notification options for services </td>
<td class='confluenceTd'> No </td>
<td class='confluenceTd'> No </td>
<td class='confluenceTd'> u,c </td>
</tr>
<tr>
<td class='confluenceTd'> NCG </td>
<td class='confluenceTd'> NCG_HOST_NOTIFICATIONS_OPTIONS </td>
<td class='confluenceTd'> Nagios notification options for hosts </td>
<td class='confluenceTd'> No </td>
<td class='confluenceTd'> No </td>
<td class='confluenceTd'> 'cn' </td>
</tr>
<tr>
<td class='confluenceTd'> NCG </td>
<td class='confluenceTd'> NCG_PROXY_LIFETIME </td>
<td class='confluenceTd'> Defines the lifetime option to refresh_proxy probe in grid-monitoring-probes-hr.srce. If unset, probe will use default value 12. (Make sure that MyProxy server supports defined credential lifetime, otherwise the probe will fail) </td>
<td class='confluenceTd'> No </td>
<td class='confluenceTd'> No </td>
<td class='confluenceTd'> 12 </td>
</tr>
</tbody></table>
</div>
</li>
</ul>


<h3><a name="Update-20-Localdbchanges"></a>Localdb changes</h3>

<ul>
	<li>Migration of localdb metric configuration to JSON config
<div class='panelMacro'><table class='noteMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>JSON config files stored in /etc/ncg-metric-config.d/ must use <b>.conf</b> suffix. Otherwise NCG will ignore them.</td></tr></table></div></li>
</ul>


<p>Modification and overriding of global values NCG localdb format:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="theme: Confluence; brush: java; gutter: false"># add/modify configuration parameter
  MODIFY_METRIC_CONFIG!metric!config!value
  # add/modify dependency
  MODIFY_METRIC_DEPENDENCY!metric!dep!value
  # add/modify attribute
  MODIFY_METRIC_ATTRIBUTE!metric!attr!value
  # add/modify parameter
  MODIFY_METRIC_PARAMETER!metric!param!value
  # add/modify flag
  MODIFY_METRIC_FLAG!metric!flag!value</pre>
</div></div>
<p>should be done by using JSON configuration files in directory /etc/ncg-metric-config.d/:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="theme: Confluence; brush: java; gutter: false"># cat /etc/ncg-metric-config.d/modify.conf
{
   &quot;metric&quot; : {
      &quot;attribute&quot; : {
         &quot;attr&quot; : &quot;value&quot;
      },
      &quot;parameter&quot; : {
         &quot;param&quot; : &quot;value&quot;
      },
      &quot;flags&quot; : {
         &quot;flag&quot; : &quot;value&quot;
      },
      &quot;config&quot; : {
         &quot;config&quot; : &quot;value&quot;
      },
      &quot;dependency&quot; : {
         &quot;dep&quot; : 1
      },
   }
}</pre>
</div></div>

<ul>
	<li>Enable contacts for service flavour on a given host<br/>
Use NCG localdb to add/enable contacts for all metrics associated to a given service flavour:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="theme: Confluence; brush: java; gutter: false">ADD_SERVICEFLAVOURCONTACT!host!ServiceFlavour!email@email.com
# enables contact even if NCG_ENABLE_NOTIFICATIONS is 0
ENABLE_SERVICEFLAVOURCONTACT!host!ServiceFlavour!email@email.com</pre>
</div></div></li>
</ul>


<h2><a name="Update-20-KnownIssues"></a>Known Issues</h2>

<div class='panelMacro'><table class='noteMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>The packages sam-nagios-1.20.0-1.el5.noarch.rpm and sam-release-1.20.0-1.el5.noarch.rpm are not in the EGI repository (therefore setting a wrong version in /etc/sam-release for those using the EGI repo).</td></tr></table></div>

<div class='panelMacro'><table class='noteMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>For machines running latest version of glite-UI (3.2.10-1 or higher):<br/>
Please restart Nagios after yaim execution. Otherwise you may see problems similar to <a href="https://tomtools.cern.ch/jira/browse/SAM-1693">SAM-1693</a>.
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="theme: Confluence; brush: java; gutter: false">service nagios restart</pre>
</div></div></td></tr></table></div>

<div class='panelMacro'><table class='noteMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Upgrading a node with yum requires a package exclusion, e.g.:
<ol>
	<li>on sam-nagios<br/>
yum update &#45;-exclude sam-gridmon</li>
	<li>on sam-gridmon<br/>
yum update &#45;-exclude sam-nagios</li>
</ol>
</td></tr></table></div>

<div class='panelMacro'><table class='noteMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Metrics ch.cern.sam.MrsCheckDBInserts and ch.cern.sam.MrsCheckDBInsertsDetailed have to be disabled manually.<br/>
Please add following lines to file /etc/ncg/ncg.localdb
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="theme: Confluence; brush: java; gutter: false">REMOVE_METRIC!ch.cern.sam.MrsCheckDBInserts
REMOVE_METRIC!ch.cern.sam.MrsCheckDBInsertsDetailed</pre>
</div></div></td></tr></table></div>

<h2><a name="Update-20-TicketsList"></a>Tickets List</h2>

<div class="error"><span class="error">jiraissues: Unable to determine if sort should be enabled.</span> </div>

				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="https://tomtools.cern.ch/confluence/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Feb 27, 2014 10:19</font></td>
		    </tr>
	    </table>
    </body>
</html>
